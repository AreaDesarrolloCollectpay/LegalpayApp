$(function () {     
    /* PROPERTY DEBT */
    
        // btn create property

        $('body').on('click', '#btnNewProperty', function (e) {
            e.preventDefault();
            var _this = $(this);
            $(".form-property")[0].reset();
            $("#property-id").val('');
            $("#property-idDebtor").val(_this.attr('data-idDebtor'));
        });
        
        // btn update payment wallet

            $('body').on('click', '.editProperty', function (e) {    
                e.preventDefault();
                var _this = $(this);
                $('#new_bien_modal #property-idDebtor').val(_this.attr('data-idDebtor'));
                $('#new_bien_modal #property-id').val(_this.attr('data-id'));
                $("#new_bien_modal #property-comment").val(_this.attr('data-comment'));                
                $("#new_bien_modal #property-number").val(_this.attr('data-number'));             
                $("#new_bien_modal #property-address").val(_this.attr('data-address'));             
                $("#new_bien_modal #property-idPropertyType").val(_this.attr('data-idPropertyType')).trigger('change');                
                $("#new_bien_modal #property-idCountry").val(_this.attr('data-idCountry')).trigger('change');
                setTimeout(function () {
                    $("#new_bien_modal #property-idDepartment").val(_this.attr('data-idDepartment')).trigger('change');
                }, 500);
                 setTimeout(function () {
                    $("#new_bien_modal #property-idCity").val(_this.attr('data-idCity'));
                }, 1000);
            });
        
        //  form create/update support debt

        $('body').on('submit', '.form-property', function (e) {
            e.preventDefault();
            var form = new FormData(this);
            $.ajax({
                url: SITEURL + "/wallet/saveProperty",
                dataType: 'json',
                type: 'POST',
                data: form,
                processData: false,
                contentType: false,
                beforeSend: function () {
                    $(".preload").fadeIn(300);
                },
                success: function (result) {
                    $(".preload").fadeOut(300);
                    toastr[result.status](result.msg);
                    if (result.status == "success") {
                        if (result.newRecord) {
                            $('#walletProperty-' + result.model.idDebtor).append(result.html);
                        } else {
                            $('#itemPropertyWallet-' + result.model.id).replaceWith(result.html);
                        }
                        actionModal();
                        if (!$('.walletProperty').hasClass("activoAcordeon")) {
                            $('.walletProperty').click();
                        }
                        $('.modal-close').click();
                    }
                }
            });
        });
        
    /* COMMENT DEBT */
    
        // btn create support 

        $('body').on('click', '#btnNewComment', function (e) {
            e.preventDefault();
            var _this = $(this);
            $(".form-comments")[0].reset();
            $("#comments-id").val('');
            $("#comments-idDebtor").val(_this.attr('data-idDebtor'));
        });
        
        //  form create/update support debt

        $('body').on('submit', '.form-comments', function (e) {
            e.preventDefault();
            var form = new FormData(this);
            $.ajax({
                url: SITEURL + "/wallet/saveComment",
                dataType: 'json',
                type: 'POST',
                data: form,
                processData: false,
                contentType: false,
                beforeSend: function () {
                    $(".preload").fadeIn(300);
                },
                success: function (result) {
                    $(".preload").fadeOut(300);
                    toastr[result.status](result.msg);
                    if (result.status == "success") {
                        if (result.newRecord) {
                            $('#walletComments-' + result.model.idDebtor).append(result.html);
                        } else {
                            $('#itemCommentWallet-' + result.model.id).replaceWith(result.html);
                        }
                        actionModal();
                        if (!$('.walletComments').hasClass("activoAcordeon")) {
                            $('.walletComments').click();
                        }
                        $('.modal-close').click();
                    }
                }
            });
        });
    /* SUPPORT DEBT */
    
        // btn create support 

        $('body').on('click', '#btnNewSupport', function (e) {
            e.preventDefault();
            var _this = $(this);
            $(".form-supports")[0].reset();
            $("#support-id").val('');
            $("#support-idDebtor").val(_this.attr('data-idDebtor'));
            $("#support-idDebtorDebt").val(_this.attr('data-idDebtorDebt'));
        });
        
        //  form create/update support debt

        $('body').on('submit', '.form-supports', function (e) {
            e.preventDefault();
            var form = new FormData(this);
            $.ajax({
                url: SITEURL + "/wallet/saveSupport",
                dataType: 'json',
                type: 'POST',
                data: form,
                processData: false,
                contentType: false,
                beforeSend: function () {
                    $(".preload").fadeIn(300);
                },
                success: function (result) {
                    $(".preload").fadeOut(300);
                    toastr[result.status](result.msg);
                    if (result.status == "success") {
                        if (result.newRecord) {
                            $('#walletSupports-' + result.model.idDebtorDebt).append(result.html);
                        } else {
                            $('#itemSupportWallet-' + result.model.id).replaceWith(result.html);
                        }
                        actionModal();
                        if (!$('.walletSupports').hasClass("activoAcordeon")) {
                            $('.walletSupports').click();
                        }
                        $('.modal-close').click();
                    }
                }
            });
        });
        
    /* SUPPORT LEGAL DEBT */
    
        // btn create support 

        $('body').on('click', '#btnNewLegalSupport', function (e) {
            e.preventDefault();
            var _this = $(this);
            $(".form-legal-supports")[0].reset();
            $("#legal-support-id").val('');
            $("#legal-support-idDebtor").val(_this.attr('data-idDebtor'));
            $("#legal-support-idDebtorDebt").val(_this.attr('data-idDebtorDebt'));
        });
        
        //  form create/update support debt

        $('body').on('submit', '.form-legal-supports', function (e) {
            e.preventDefault();
            var form = new FormData(this);
            $.ajax({
                url: SITEURL + "/wallet/saveSupport",
                dataType: 'json',
                type: 'POST',
                data: form,
                processData: false,
                contentType: false,
                beforeSend: function () {
                    $(".preload").fadeIn(300);
                },
                success: function (result) {
                    $(".preload").fadeOut(300);
                    toastr[result.status](result.msg);
                    if (result.status == "success") {
                        $('#contentSupportsLegal').removeClass('hide');
                        if (result.newRecord) {
                            $('#walletSupportsLegal-' + result.model.idDebtorDebt).append(result.html);
                        } else {
                            $('#itemSupportWallet-' + result.model.id).replaceWith(result.html);
                        }
                        actionModal();
                        if (!$('.walletSupports').hasClass("activoAcordeon")) {
                            $('.walletSupports').click();
                        }
                        $('.modal-close').click();
                    }
                }
            });
        });
        
    /* PHONES WALLETS */
    
        // btn create phone wallet

        $('body').on('click', '#btnNewPhone', function (e) {
            e.preventDefault();
            var _this = $(this);
            $(".form-walletPhone")[0].reset();
            $("#phones-id").val('');
            $("#phones-idDebtor").val(_this.attr('data-idDebtor'));
        });
        
        // btn update phone wallet

        $('body').on('click', '.editWalletPhone', function (e) {    
            e.preventDefault();
            var _this = $(this);
            $("#new_phone_modal #phones-id").val(_this.attr('data-id'));
            $("#new_phone_modal #phones-idDebtor").val(_this.attr('data-idDebtor'));
            $("#new_phone_modal #phones-number").val(_this.attr('data-number'));
            $("#new_phone_modal #phones-comment").val(_this.attr('data-comment'));
            $("#new_phone_modal #phones-active").val(_this.attr('data-active'));
            $("#new_phone_modal #phones-idTypeReference").val(_this.attr('data-idTypeReference')).trigger('change');
            $("#new_phone_modal #phones-idPhoneClass").val(_this.attr('data-idPhoneClass')).trigger('change');
            $("#new_phone_modal #phones-idCountry").val(_this.attr('data-idCountry')).trigger('change');
            setTimeout(function () {
                $("#new_phone_modal #phones-idDepartment").val(_this.attr('data-idDepartment')).trigger('change');
            }, 500);
            setTimeout(function () {
                $("#new_phone_modal #phones-idCity").val(_this.attr('data-idCity'));
            }, 1000);


        });
        
        //  form create/update address wallets

        $('body').on('submit', '.form-walletPhone', function (e) {
            e.preventDefault();
            var form = new FormData(this);
            $.ajax({
                url: SITEURL + "/wallet/saveDemographicPhone",
                dataType: 'json',
                type: 'POST',
                data: form,
                processData: false,
                contentType: false,
                beforeSend: function () {
                    $(".preload").fadeIn(300);
                },
                success: function (result) {
                    $(".preload").fadeOut(300);
                    toastr[result.status](result.msg);
                    if (result.status == "success") {
                        if (result.newRecord) {
                            $('#walletPhones-' + result.model.idDebtor).append(result.html);
                        } else {
                            $('#itemDemographicWalletPhone-' + result.model.id).replaceWith(result.html);
                        }
                        actionModal();
                        if (!$('.walletPhone').hasClass("activoAcordeon")) {
                            $('.walletPhone').click();
                        }
                        $('.modal-close').click();
                    }
                }
            });
        });
        
        
    /* REFERENCE WALLETS */
    
        // btn create reference wallet
        $('body').on('click', '#btnNewReference', function (e) {
            e.preventDefault();
            var _this = $(this);
            $('.form-walletContact').trigger("reset");
            $("#reference-id").val('');
            $("#debtor-contact-idDebtor").val(_this.attr('data-idDebtor'));
            $("#new_debcontact_modal h1").text(_this.attr('data-title'));
            $("#debtor-contact-typeDebtorContact").val(_this.attr('data-tContact'));
        });
        
        // btn update reference wallet

        $('body').on('click', '.editReference', function (e) {    
            e.preventDefault();
            var _this = $(this);
            
            $("#new_referencia_modal #reference-id").val(_this.attr('data-id'));
            $("#new_referencia_modal #reference-idDebtor").val(_this.attr('data-idDebtor'));
            $("#new_referencia_modal #reference-name").val(_this.attr('data-name'));
            $("#new_referencia_modal #reference-address").val(_this.attr('data-address'));
            $("#new_referencia_modal #reference-phone").val(_this.attr('data-phone'));
            $("#new_referencia_modal #reference-email").val(_this.attr('data-email'));
            $("#new_referencia_modal #reference-comment").val(_this.attr('data-comment'));
            $("#new_referencia_modal #reference-active").val(_this.attr('data-active'));
            $("#new_referencia_modal #reference-idTypeReference").val(_this.attr('data-idTypeReference')).trigger('change');
            $("#new_referencia_modal #reference-idCountry").val(_this.attr('data-idCountry')).trigger('change');
            setTimeout(function () {
                $("#new_referencia_modal #reference-idDepartment").val(_this.attr('data-idDepartment')).trigger('change');
                $("#new_referencia_modal #reference-idRelationshipType").val(_this.attr('data-idRelationshipType')).trigger('change');
            }, 500);
            setTimeout(function () {
                $("#new_referencia_modal #reference-idCity").val(_this.attr('data-idCity'));
            }, 1000);


        });
       
    /* CO-SIGNER WALLETS */
    
        // btn create co-signers wallet
        $('body').on('click', '#btnNewCoSigner', function (e) {
            e.preventDefault();
            var _this = $(this);
            $('.form-walletContact').trigger("reset");
            $("#co-signer-id").val('');
            $("#debtor-contact-idDebtor").val(_this.attr('data-idDebtor'));
            $("#new_debcontact_modal h1").text(_this.attr('data-title'));
            $("#debtor-contact-typeDebtorContact").val(_this.attr('data-tContact'));
        });
        
        // btn update reference wallet

        $('body').on('click', '.editCoSigner', function (e) {    
            e.preventDefault();
            var _this = $(this);
            
            $("#new_co-signer_modal #co-signer-id").val(_this.attr('data-id'));
            $("#new_co-signer_modal #co-signer-idDebtor").val(_this.attr('data-idDebtor'));
            $("#new_co-signer_modal #co-signer-name").val(_this.attr('data-name'));
            $("#new_co-signer_modal #co-signer-address").val(_this.attr('data-address'));
            $("#new_co-signer_modal #co-signer-phone").val(_this.attr('data-phone'));
            $("#new_co-signer_modal #co-signer-email").val(_this.attr('data-email'));
            $("#new_co-signer_modal #co-signer-comment").val(_this.attr('data-comment'));
            $("#new_co-signer_modal #co-signer-active").val(_this.attr('data-active'));
            $("#new_co-signer_modal #co-signer-idCountry").val(_this.attr('data-idCountry')).trigger('change');
            setTimeout(function () {
                $("#new_co-signer_modal #co-signer-idDepartment").val(_this.attr('data-idDepartment')).trigger('change');
            }, 500);
            setTimeout(function () {
                $("#new_co-signer_modal #co-signer-idCity").val(_this.attr('data-idCity'));
            }, 1000);


        });
        
        //  form create/update reference wallets

        $('body').on('submit', '.form-walletContact', function (e) {
            e.preventDefault();
            var form = new FormData(this);
            var typeC = form.get("idTypeDebtorContact"); 
            var id = (typeC == 1) ? "walletCo-signer-" : "walletReference-";
            var idAcordeon = (typeC == 1) ? "walletCod-" : "walletRef-";
            var dataId = "debtor-contact-";
            $.ajax({
                url: SITEURL + "/wallet/saveDemographicContact",
                dataType: 'json',
                type: 'POST',
                data: form,
                processData: false,
                contentType: false,
                beforeSend: function () {
                    $(".preload").fadeIn(300);
                },
                success: function (result) {
                    $(".preload").fadeOut(300);
                    toastr[result.status](result.msg);
                    if (result.status == "success") {
                        if (result.newRecord) {
                            $('#'+id + result.model.idDebtor).append(result.html);
                            acordeon(idAcordeon+result.model.id);    
                            getLocation(dataId+result.model.id+'-',result.location);
                        }         
                        if (!$('#'+idAcordeon+result.model.id).hasClass("activoAcordeon")) {
                            $('#'+idAcordeon+result.model.id).click();
                        }
                        $('.modal-close').click();
                    }
                }
            });
            return false;
        });
        
    /* EMAIL WALLETS */
    
        // btn create email wallet

        $('body').on('click', '#btnNewEmail', function (e) {
            e.preventDefault();
            var _this = $(this);
            $(".form-walletEmail")[0].reset();
            $("#email-id").val('');
            $("#email-idDebtor").val(_this.attr('data-idDebtor'));
        });
        
        // btn update email wallet

        $('body').on('click', '.editEmail', function (e) {    
            e.preventDefault();
            var _this = $(this);

            $("#new_correo_modal #email-id").val(_this.attr('data-id'));
            $("#new_correo_modal #email-idDebtor").val(_this.attr('data-idDebtor'));
            $("#new_correo_modal #email-name").val(_this.attr('data-name'));
            $("#new_correo_modal #email-email").val(_this.attr('data-email'));
            $("#new_correo_modal #email-comment").val(_this.attr('data-comment'));
            $("#new_correo_modal #email-active").val(_this.attr('data-active'));
            $("#new_correo_modal #email-idTypeReference").val(_this.attr('data-idTypeReference')).trigger('change');
        });
                
        //  form create/update email wallets

        $('body').on('submit', '.form-walletEmail', function (e) {
            e.preventDefault();
            var form = new FormData(this);
            $.ajax({
                url: SITEURL + "/wallet/saveDemographicEmail",
                dataType: 'json',
                type: 'POST',
                data: form,
                processData: false,
                contentType: false,
                beforeSend: function () {
                    $(".preload").fadeIn(300);
                },
                success: function (result) {
                    $(".preload").fadeOut(300);
                    toastr[result.status](result.msg);
                    if (result.status == "success") {
                        if (result.newRecord) {
                            $('#walletEmail-' + result.model.idDebtor).append(result.html);
                        } else {
                            $('#itemDemographicWalletEmail-' + result.model.id).replaceWith(result.html);
                        }
                        actionModal();
                        if (!$('.walletEmail').hasClass("activoAcordeon")) {
                            $('.walletEmail').click();
                        }
                        $('.modal-close').click();
                    }
                }
            });
            return false;
        });
    
    /* ADDRESSES WALLETS */
    
        // btn create address wallet

        $('body').on('click', '#btnNewAddress', function (e) {
            e.preventDefault();
            var _this = $(this);
            $(".form-walletAddress")[0].reset();
            $("#address-id").val('');
            $("#address-idDebtor").val(_this.attr('data-idDebtor'));
        });

        // btn update address wallet

        $('body').on('click', '.editWalletAddress', function (e) {
            e.preventDefault();
            var _this = $(this);
            $("#new_address_modal #address-id").val(_this.attr('data-id'));
            $("#new_address_modal #address-idDebtor").val(_this.attr('data-idDebtor'));
            $("#new_address_modal #address-address").val(_this.attr('data-address'));
            $("#new_address_modal #address-comment").val(_this.attr('data-comment'));
            $("#new_address_modal #address-neighborhood").val(_this.attr('data-neighborhood'));
            $("#new_address_modal #address-active").val(_this.attr('data-active'));
            $("#new_address_modal #address-idTypeReference").val(_this.attr('data-idTypeReference')).trigger('change');
            $("#new_address_modal #address-idCountry").val(_this.attr('data-idCountry')).trigger('change');
            setTimeout(function () {
                $("#new_address_modal #address-idDepartment").val(_this.attr('data-idDepartment')).trigger('change');
            }, 500);
             setTimeout(function () {
                $("#new_address_modal #address-idCity").val(_this.attr('data-idCity'));
            }, 1000);
        });

        //  form create/update address wallets

        $('body').on('submit', '.form-walletAddress', function (e) {
            e.preventDefault();
            var form = new FormData(this);
            $.ajax({
                url: SITEURL + "/wallet/saveDemographicAddress",
                dataType: 'json',
                type: 'POST',
                data: form,
                processData: false,
                contentType: false,
                beforeSend: function () {
                    $(".preload").fadeIn(300);
                },
                success: function (result) {
                    $(".preload").fadeOut(300);
                    toastr[result.status](result.msg);
                    if (result.status == "success") {
                        if (result.newRecord) {
                            $('#walletAddress-' + result.model.idDebtor).append(result.html);
                        } else {
                            $('#itemDemographicWalletAddress-' + result.model.id).replaceWith(result.html);
                        }
                        actionModal();
                        if (!$('.walletAddress').hasClass("activoAcordeon")) {
                            $('.walletAddress').click();
                        }
                        $('.modal-close').click();
                    }
                }
            });
            return false;
        });
    
    
    // DELETE ITEM DEMOGRAPHIC WALLET GLOBAL
        
    $('body').on('click', '.deleteItemDemographicWallet', function (e) {
        e.preventDefault();
        var _this = $(this);
        $.ajax({
            url: SITEURL + "/wallet/deleteDemographic",
            dataType: 'json',
            type: 'POST',
            data: {idDemographic : _this.attr('idDemographic')},
            beforeSend: function () {
                $(".preload").fadeIn(300);
            },
            success: function (result) {
                $(".preload").fadeOut(300);
                toastr[result.status](result.msg);
                if (result.status == "success") {
                        $('#itemDemographicWallet-' + result.model.idDemographic).remove();                   
                }
            }
        });
        return false;
    });
                
     /* PAYMENTS */ 
     
        $('body').on('click', '.btn-payment', function (e) {
            var _this = $(this);            
            $(".form-payments")[0].reset();
            $('#t-pago-deuda').html(_this.attr('data-titulo-deuda'));
            $('#payment-idWallet').val(_this.attr('data-idDebtor'));
            $('#payment-idDebtorDebt').val(_this.attr('data-idDebtorDebt'));
            $("#payment-idPayment").val('');                      
            
        });
    
        //    form payments wallets

        $('body').on('submit', '.form-payments', function (e) {
            e.preventDefault();
            var form = new FormData(this);
            form.append("timer", $("#timer").html());
            $.ajax({
                url: SITEURL + "/wallet/savePayment",
                dataType: 'json',
                type: 'POST',
                data: form,
                processData: false,
                contentType: false,
                beforeSend: function () {
                    $(".preload").fadeIn(300);
                },
                success: function (result) {
                    $(".preload").fadeOut(300);
                    toastr[result.status](result.msg);
                    if (result.status == "success") {
                        if (!result.newRecord) {
                            $('#itemPaymentWallet-' + result.model.id).remove();
                        }
                        $('#wallet'+result.type+'-' + result.model.idDebtorDebt).append(result.html);
                        actionModal();
                        $('#new_payment_modal').closeModal();
                    }
                }
            });
            return false;
        });
    
        // btn update payment wallet

            $('body').on('click', '.editWalletPayment', function (e) {    
                e.preventDefault();
                var _this = $(this);
                $('#payment-idWallet').val(_this.attr('data-idWallet'));
                $('#payment-idDebtorDebt').val(_this.attr('data-idDebtorDebt'));
                $("#new_payment_modal #paymentDate").val(_this.attr('data-paymentDate'));
                $("#new_payment_modal #paymentValue").val(_this.attr('data-paymentValue'));            
                $("#new_payment_modal #payment-idPayment").val(_this.attr('data-idPayment'));
                $("#new_payment_modal #idPaymentTypeState").val(_this.attr('data-idPaymentTypeState'));
                $("#new_payment_modal #idPaymentTypesClass").val(_this.attr('data-idPaymentTypeClass'));
                $("#new_payment_modal #idPaymentTypePaidTo").val(_this.attr('data-idPaymentTypePaidTo'));
                $("#new_payment_modal #idPaymentTypeMethod").val(_this.attr('data-idPaymentTypeMethod'));
                $("#new_payment_modal #idPaymentTypeDiscrimination").val(_this.attr('data-idPaymentTypeDiscrimination'));
            });
    
    /* SPENDING */ 
     
        $('body').on('click', '.btn-spending', function (e) {
            var _this = $(this);            
            $(".form-spending")[0].reset();
//            $('#t-pago-deuda').html(_this.attr('data-titulo-deuda'));
            $('#spending-idDebtor').val(_this.attr('data-idDebtor'));
            $('#spending-idDebtorDebt').val(_this.attr('data-idDebtorDebt'));
            $("#spending-id").val('');                      
            
        });
    
        //    form payments wallets

        $('body').on('submit', '.form-spending', function (e) {
            e.preventDefault();
            var form = new FormData(this);
            form.append("timer", $("#timer").html());
            $.ajax({
                url: SITEURL + "/wallet/saveSpending",
                dataType: 'json',
                type: 'POST',
                data: form,
                processData: false,
                contentType: false,
                beforeSend: function () {
                    $(".preload").fadeIn(300);
                },
                success: function (result) {
					console.log(result);
                    $(".preload").fadeOut(300);
                    toastr[result.status](result.msg);
                    if (result.status == "success") {
                        if (result.newRecord) {
                            $('#walletSpending-' + result.model.idDebtorDebt).append(result.html);
                        } else {
                            $('#itemSpendingWallet-' + result.model.id).replaceWith(result.html);
                        }
                        actionModal();
                        $('.modal-close').click();
                    }
                }
            });
            return false;
        });
    
        // btn update spending wallet

            $('body').on('click', '.editWalletSpending', function (e) {    
                e.preventDefault();
                var _this = $(this);
                $('#new_spending_modal #spending-idDebtor').val(_this.attr('data-idWallet'));
                $('#new_spending_modal #spending-id').val(_this.attr('data-idSpending'));
                $("#new_spending_modal #spending-dateSpending").val(_this.attr('data-spendingDate'));
                $("#new_spending_modal #spending-comments").val(_this.attr('data-spendingComments'));                
                $("#new_spending_modal #spending-value").val(_this.attr('data-spendingValue'));                            
                $("#new_spending_modal #spending-idSpendingType").val(_this.attr('data-idSpendingType'));
                $("#new_spending_modal #spending-idCountry").val(_this.attr('data-idCountry')).trigger('change');
                setTimeout(function () {
                    $("#new_spending_modal #spending-idDepartment").val(_this.attr('data-idDepartment')).trigger('change');
                }, 500);
                 setTimeout(function () {
                    $("#new_spending_modal #spending-idCity").val(_this.attr('data-idCity'));
                }, 1000);
            });
    
    
 /* OTHERS */
    
    $('body').on('click', '.btn-support', function (e) {
        var _this = $(this);
        $('#support-idDebtor').val(_this.attr('data-idDebtor'));
        //$('#t-soporte-deuda').html(_this.attr('data-titulo-deuda'));
    });  
    
    $('body').on('click', '.btn-support-legal', function (e) {
        var _this = $(this);
        $('#legal-support-idDebtor').val(_this.attr('data-idDebtor'));
        //$('#t-soporte-deuda').html(_this.attr('data-titulo-deuda'));
    });    
 
    /* Form management */
    $('body').on('submit', '.form-management', function (e) {
        e.preventDefault();
        var form = new FormData(this);
                    
        $.ajax({
                url: SITEURL + "/wallet/saveTasks",
                dataType: 'json',
                type: 'POST',
                data: form,
                processData: false,
                contentType: false,
                beforeSend: function () {
                    $(".preload").fadeIn(300);
                },
                success: function (result) {
                    $(".preload").fadeOut(300);
                    toastr[result.status](result.msg);
                    if (result.status == "success") {
                        $(".form-management")[0].reset();
                         setTimeout(function () {
                           location.href = SITEURL+"/wallet/debtor/"+result.model.idDebtorDebt; 
                        }, 800);
                    }
                }
            });
        return false;
    });
    
    /* edit tasks */
        
    $('body').on('click', '.editTaskDebtor', function (e) {    
        e.preventDefault();
        var _this = $(this);
        $.ajax({
            url: SITEURL + '/wallet/getManagement',
            dataType: 'json',
            type: 'POST',
            data: {id : _this.attr('data-id')},
            success: function(result){
                if (result.status == "success") {                    
                    $('#tasks-m-dateTask').val(result.model.date).attr('readonly',true);
                    $('#tasks-m-comment').val(result.model.comments);
                    $('#tasks-m-id').val(result.model.id);
                    if(result.model.idDebtorState != ''){
                        setTimeout(function () {
                            $('#tasks-m-idDebtorState').val(result.model.idDebtorState).trigger('change');
                            setTimeout(function () {
                               $('#tasks-m-idDebtorSubState').val(result.model.idDebtorSubState).trigger('change');
                           }, 500);
                        }, 500);
                    }
                    
                    
                }else{
                  toastr[result.status](result.msg);  
                }
            }
        });
    });
    
    /* edit reports */
        
    $('body').on('click', '.editReport', function (e) {    
        e.preventDefault();
        var _this = $(this);
        $.ajax({
            url: SITEURL + '/wallet/getReport',
            dataType: 'json',
            type: 'POST',
            data: {idTypeReport : _this.attr('data-idTypeReport'), idDebtorDebt : _this.attr('data-idDebtorDebt')},
            success: function(result){
                if (result.status == "success") {                    
                    console.log(result.model);
                    $('#report-date').val(result.model.date);
                    $('#report-comments').val(result.model.comments);
                    $('#report-idDebtorDebt').val(result.model.idDebtorDebt);
                    $('#report-idTypeReport').val(result.model.idTypeReport);
                    $('#report-id').val(result.model.id);                    
                }else{
                  toastr[result.status](result.msg);  
                }
            }
        });
    });    
    $('body').on('submit', '.form-report', function (e) {
        e.preventDefault();
        var form = new FormData(this);
                    
        $.ajax({
            url: SITEURL + "/wallet/saveReport",
            dataType: 'json',
            type: 'POST',
            data: form,
            processData: false,
            contentType: false,
            beforeSend: function () {
                $(".preload").fadeIn(300);
            },
            success: function (result) {
                $(".preload").fadeOut(300);
                toastr[result.status](result.msg);
                if (result.status == "success") {
                    $('#modal_reports').closeModal();
                    $('#itemReports-' + result.model.idTypeReport).replaceWith(result.html);
                    actionModal();
                }
            }
        });
        return false;
    });
    
    /* Form call */
    $('body').on('submit', '.form-call', function (e) {
        e.preventDefault();
        var form = new FormData(this);
                    
        $.ajax({
            url: SITEURL + "/wallet/saveCall",
            dataType: 'json',
            type: 'POST',
            data: form,
            processData: false,
            contentType: false,
            beforeSend: function () {
                $(".preload").fadeIn(300);
            },
            success: function (result) {
                $(".preload").fadeOut(300);
                toastr[result.status](result.msg);
                if (result.status == "success") {
                    $("#is_contact").val(0);
                    $('#txtPhoneNumber option:first').attr('selected',true);
                    $("#ta-comment").val();
                    $('#tbody-management-' + result.model.idDebtorDebt).prepend(result.html); 
                    $('#modal_call').closeModal();
                    actionModal();
                    $('.phone__content__inner').hide();
                    $('.phone__content1').fadeIn();
                    $('.phone').removeClass('call_on').addClass('call_off');
                    $('#content-form-call').append($('#content-form-management').detach());
                    document.getElementById("tasks-call-idDebtorState").selectedIndex = ''
                    $('#tasks-call-comments').val('');
                    setTimeout(function () { 
                        $('.phone__overlay').click();
                        console.log('action call');
                        $('.phone__overlay').trigger("click");
                    },300);
                    //$('#tasks-call-idDebtorState').prop('selectedIndex',0);
                }
            }
        });
        return false;
    });
    
    $("#cancelBtnSupport").bind('click', function () {
        $("#new_sporte_modal").modal('hide');
    });   
    
    // tasks modal
    
    $('body').on('click', '.tasks-modal', function (e) {
        e.preventDefault();
        $(".form-management")[0].reset();
    });
    
     // TASKS SUPPORT
    
    $('body').on('change','.select-tasksSupport',function(e){
        e.preventDefault();        
        var _this = $(this);
        var element = "#"+_this.closest("form").attr("data-id");        
        
        if($(element+'idTasksAction').val() == 12 || $(element+'idTasksAction').val() == 6 || $(element+'idTasksAction').val() == 9 || $(element+'idTasksAction').val() == 21 || $(element+'idTasksAction').val() == 29){ 
            if($(element+'idTasksAction').val() == 6|| $(element+'idTasksAction').val() == 9){
                //$(element+'support').removeAttr( "multiple" );
            }else{
                //$(element+'support').attr('multiple',true);
            }
            $("#file-task").removeClass('hide');
        }else{
            $("#file-task").addClass('hide');            
        }
        
        if($(element+'idTasksAction').val() == 1 || $(element+'idTasksAction').val() == 12){
            $(element+'is_contact').attr('disabled',false);
        }else{
            $(element+'is_contact').attr('disabled',true);            
        }
        
    });   
    
    /* View more management */
    
        $('body').on('click', '.viewManagement', function (e) {
            e.preventDefault();
            var _this = $(this);
            $.ajax({
                url: SITEURL + '/wallet/getMoreManagementDebtor',
                dataType: 'json',
                type: 'POST',
                data: {idDebtor : _this.attr('data-idDebtor'),idUserAsigned : _this.attr('data-idUserAsigned')},
                beforeSend: function(){
                    $("#more-management").empty();
                },
                success: function(result){
                    $("#more-management").html(result.html);
                    $('.collapsible').collapsible();
                }
            });
        
        });
        
    /* View more management */
    
        $('body').on('click', '.viewSupportManagement', function (e) {
            e.preventDefault();
            var _this = $(this);
            $.ajax({
                url: SITEURL + '/wallet/getSupportManagementDebtor',
                dataType: 'json',
                type: 'POST',
                data: {idTasks : _this.attr('data-idTask')},
                beforeSend: function(){
                    $("#suport-management").empty();
                },
                success: function(result){
                    $("#suport-management").html(result.html);
//                    $('.slider').slider();
                    $('#suport-management .materialboxed').materialbox();
                    $(".modal_clic").leanModal();
                }
            });
        
        });
        
    /* View detail obligation */
    
        $('body').on('click', '.viewDebtorObligation', function (e) {
            e.preventDefault();
            var _this = $(this);
            $.ajax({
                url: SITEURL + '/wallet/getDebtorObligation',
                dataType: 'json',
                type: 'POST',
                data: {id : _this.attr('data-id')},
                beforeSend: function(){
                    $("#debtor_obligation").empty();
                },
                success: function(result){
                    $("#debtor_obligation").html(result.html);
                    $(".modal_clic").leanModal();
                }
            });
        
        });
    
    /* STATE WALLET */
        
        /* CHANGE TYPE LEGAL */

        $('body').on('change', '#debtorObligations-is_legal', function (e) {
            e.preventDefault();
            var _this = $(this);
            $.ajax({
                url: SITEURL + '/wallet/getStateDebtor',
                dataType: 'json',
                type: 'POST',
                data: {idDebtor : _this.attr('data-idDebtor'), is_legal : _this.val()},
                beforeSend: function () {
                    $(".preload").fadeIn(300);
                },
                success: function (result) {
                    $(".preload").fadeOut(300);
                    if(result.status == 'success'){
                        $('#debtorObligations-idDebtorState').html(result.html);


                        if(result.model.is_legal){
                            $('#content-subState').removeClass('hide');
                        }else{
                            $('#content-subState').addClass('hide');                                
                        }
                    }else{
                        toastr[result.status](result.msg);                            
                    }
                }
            });

        });
        
    /* CHANGE STATE WALLET */
    
        $('body').on('change', '.stateWallet', function (e) {
            e.preventDefault();
            var _this = $(this);
            $.ajax({
                url: SITEURL + '/wallet/stateWallet',
                dataType: 'json',
                type: 'POST',
                data: {idDebtor : _this.attr('data-idDebtor'), idState : _this.val()},
                beforeSend: function () {
                    $(".preload").fadeIn(300);
                },
                success: function (result) {
                    $(".preload").fadeOut(300);
                    toastr[result.status](result.msg);
                }
            });
        
        });
                        
                
        $('body').on('submit','',function(e){
                 
        });
        
    /* UPDATE LEGAL DEBTOR  */
    
    $('.form-stateLegal').on('change', 'input, select, textarea', function(e){
        e.preventDefault();
        var formElement = document.querySelector(".form-stateLegal");
        var form = new FormData(formElement);  
        $.ajax({
            url: SITEURL + "/wallet/officeLegalDebtor",
            dataType: 'json',
            type: 'POST',
            data: form,
            processData: false,
            contentType: false,
            success: function (result) {
                if (result.status != "success") {
                    toastr[result.status](result.msg);

                }
            }
        });       
    });
    
    
    
    /* UPDATE DEBTOR */
    
    $('body').on('submit','.form-debtors',function(e){
        e.preventDefault();
        var form = new FormData(this);
        $.ajax({
            url: SITEURL + "/wallet/updateDebtor",
            dataType: 'json',
            type: 'POST',
            data: form,
            processData: false,
            contentType: false,
            beforeSend: function () {
                $(".preload").fadeIn(300);
            },
            success: function (result) {
                $(".preload").fadeOut(300);
                toastr[result.status](result.msg);
                if (result.status == "success") {

                }
            }
        });            
    });
    
    /* CHANGE STATE TASK */
    
        $('body').on('change','.tasks-debtorState',function(e){
            e.preventDefault();
            var this_ = $(this);

            if(this_.val() == 1){
               $('.task-value').prop('readonly', false);
            }else{
                $('.task-value').prop('readonly', true);
            }

        });
    
    
    /* OPEN MODAL SMS DEBTOR DETAIL */
    
        $('body').on('click','.sms-detail-debtor',function(e){
            e.preventDefault();
            var _this = $(this);
            $(".form-sms-wallets")[0].reset();
            $("#sms-wallets-idDebtor").val(_this.attr('data-idDebtor'));
        });
        /* SEND SMS DEBTOR DETAIL */
        $('body').on('submit','.form-sms-wallets',function(e){
            e.preventDefault();
            var form = new FormData(this);
            $.ajax({
                url: SITEURL + "/wallet/smsDebtor",
                dataType: 'json',
                type: 'POST',
                data: form,
                processData: false,
                contentType: false,
                beforeSend: function () {
                    $(".preload").fadeIn(300);
                },
                success: function (result) {
                    $(".preload").fadeOut(300);
                    toastr[result.status](result.msg);
                    if (result.status == "success") {
                       $(".form-sms-wallets")[0].reset();
                       $('#sms_detail_debtor').closeModal();
                       $('#tbody-management-' + result.model.idDebtor).prepend(result.html); 
                    }
                }
            });            
        });
        
    /* OPEN MODAL EMAIL DEBTOR DETAIL */
    
        $('body').on('click','.email-detail-debtor',function(e){
            e.preventDefault();
            var _this = $(this);
            $(".form-email-wallets")[0].reset();
            $("#email-wallets-idDebtor").val(_this.attr('data-idDebtor'));
        });
        /* SEND SMS DEBTOR DETAIL */
        $('body').on('submit','.form-email-wallets',function(e){
            e.preventDefault();
            var form = new FormData(this);
            $.ajax({
                url: SITEURL + "/wallet/emailDebtor",
                dataType: 'json',
                type: 'POST',
                data: form,
                processData: false,
                contentType: false,
                beforeSend: function () {
                    $(".preload").fadeIn(300);
                },
                success: function (result) {
                    $(".preload").fadeOut(300);
                    toastr[result.status](result.msg);
                    if (result.status == "success") {
                       $(".form-email-wallets")[0].reset();
                       $('#email_detail_debtor').closeModal();
                       $('#tbody-management-' + result.model.idDebtor).prepend(result.html); 
                    }
                }
            });            
        });
        
});

/* FUNTIONS */

function smartSelect(){
    $("select.debtorObligations-idDebtorSubState").smartselect({
        defaultView: "root",
        text: {
            selectLabel: "Seleccionar"
        },
        toolbar: false,
        callback: {
            onOptionSelected: [
                // if inputbox has no value, disable select
                function($target, event) {
//                    $('#btn-form-state-legal').removeClass('hide');
//                    console.log("you deselec36ted " + $target.attr("data-value"));
                }
            ]
        },
    });   
}

// recursos para cargas despues de un ajax
function actionModal() {
//    $(".tooltipped").tooltip();
    $(".modal_clic").leanModal();
}

function acordeon(idAcordeon){
      
    $('#'+idAcordeon).click(function(){
        if($(this).hasClass('activoAcordeon')){
            $(this).removeClass('activoAcordeon');
            $(this).siblings('.respuesta').slideUp();
            $(this).children('.triangulo').removeClass('rotar');
        }else{
            $(this).removeClass('activoAcordeon');
            $(this).siblings('.respuesta').slideUp();
            $(this).children('.triangulo').removeClass('rotar');
            $(this).addClass('activoAcordeon');
            $(this).parent().find('.respuesta').slideDown();
            $(this).children('.triangulo').addClass('rotar');
        }
    });
    
}

function getLocation(id,model){
    $("#"+id+"idCountry").val(model.idCountry).trigger("change");
    setTimeout(function(){        
        $("#"+id+"idDepartment").val(model.idDepartment).trigger("change");
        setTimeout(function(){        
            $("#"+id+"idCity").val(model.idCity).trigger("change");
        },500);                
    },1000);
}

$(window).on('load', function() {
    setTimeout(function(){
        $('#m-wallets').trigger('click');
        $('#m-dashboard').addClass('active');
    },250);
});

