$(function () { 
    
    /**
     * Create the chart when all data is loaded
     * @returns {undefined}
     */
    var series;
    function createChart() {

        $.ajax({
            url: SITEURL + "/machine/getChartClusters",
            async: false,
            dataType: 'json',
            type: 'POST',
            data: {},
            success: function (result) {
                series = result.data;
            }
        });



        Highcharts.chart('container', {
            chart: {
                type: 'packedbubble',
                //        height: '100%'
            },
            title: {
                text: '',
            },
            tooltip: {
                positioner: function () {
                    return {x: 60, y: 30};
                },
                useHTML: true,
                pointFormat: '<b class=txt_center"">{point.name}</b> </br>' +
                        '<b>Instancias:</b> {point.value}</br>'

            },
            plotOptions: {
                packedbubble: {
                    minSize: '30%',
                    maxSize: '120%',
                    zMin: 0,
                    zMax: 1000,
                    layoutAlgorithm: {
                        splitSeries: true,
                        gravitationalConstant: 0.02
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.name}',
//                    filter: {
//                        property: 'y',
//                        operator: '>',
//                        value: 250
//                    },
                        style: {
                            color: 'black',
                            textOutline: 'none',
                            fontWeight: 'normal',
                            fontSize: '8px'
                        }
                    }
                },
                series: {
                    cursor: 'pointer',
                    events: {
                        click: function (event) {
                            showDebtors(event.point.id);
                            console.log(event.point.id);
                        }
                    }
                }
            },
            legend: {
                enabled: false,
            },
            series: series,
            exporting: {
                enabled: false
            }
        });

        setTimeout(function () {
            $('.highcharts-credits').fadeOut('slow');
        }, 500);
    }
    createChart();
});

function actionModal() {
//    $(".tooltipped").tooltip();
    $(".modal_clic").leanModal();
}

function showDebtors(id){
    
    $.ajax({
        url: SITEURL + "/wallet",
        async: false,
        dataType: 'json',
        type: 'POST',
        data: {ajax : true, idCluster : id},
        success: function (result) {
            if (result.status == "success") {
                $('#debtors_list').removeClass('hide');
                $('#tbody-cluster').html(result.table);
                $('#pagination-cluster').html(result.pagination);
            }else{
                $('#debtors_list').addClass('hide');
                toastr[result.status](result.msg);
            }
        }
    });
    
    return false;
}

$(window).on('load', function() {
    setTimeout(function(){
        $('#m-wallets').trigger('click');
        $('#m-machine').addClass('active');
    },250);
});