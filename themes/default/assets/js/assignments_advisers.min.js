$(function () {
    
    
    $('body').on('change', '.select-data-import', function(e){
        e.preventDefault();
        var _this = $(this);
        var _elm = $('#download-pl');
        if(_this.val() != ''){           
            _elm.removeClass('hide');            
        }else{
            _elm.addClass('hide');                        
        }
    });
    
    $('body').on('click', '#download-pl', function(e){
        e.preventDefault();
        var _this = $(this);
        var formElement = document.querySelector(".form-assignments-advisers");
        var form = new FormData(formElement);
        $.ajax({
            url: SITEURL + "/usersImport/template",
            dataType: 'json',
            type: 'POST',
            data: form,
            processData: false,
            contentType: false,
            success: function (result) {
                if (result.status == "error") {
                    toastr[result.status](result.msg);
                }else{
                   $('#download-file').attr('href', SITEURL + result.file);
                   setTimeout(function(){
                       //$('#download-file').trigger('click')
                       document.querySelector('#download-file').click();
                       console.log('click');
                   },100);
                }
            }
        });
    });

    $('body').on('submit', '.form-assignments-advisers', function (e) {
        e.preventDefault();
        var form = new FormData(this);
        $.ajax({
            url: SITEURL + "/assignments/saveAssignmentsAdvisers",
            dataType: 'json',
            type: 'POST',
            data: form,
            processData: false,
            contentType: false,
            beforeSend: function () {
                $(".preload").fadeIn(300);
            },
            success: function (result) {
                $(".preload").fadeOut(300);
                toastr[result.status](result.msg);
                if (result.status == "success") {
                    $('#assignments-count').html(result.count);
                    $('#assignments-error').html(result.error);                    
                    $('#assignments-id').val(result.model.id);                    
                    setTimeout(function (){
                        $('#load_assignments').openModal();
                    }, 200);
                }
            }
        });
    });
    
    $('body').on('submit', '.form-import-assignments', function (e) {
        e.preventDefault();
        var form = new FormData(this);
        $.ajax({
            url: SITEURL + "/assignments/ImportAssignments",
            dataType: 'json',
            type: 'POST',
            data: form,
            processData: false,
            contentType: false,
            beforeSend: function () {
                $(".preload").fadeIn(300);
            },
            success: function (result) {
                $(".preload").fadeOut(300);
                toastr[result.status](result.msg);
                if (result.status == "success") {
                      $('#load_assignments').openModal();
                    setTimeout(function () {
                        location.reload();
                    }, 200);
                }
            }
        });
    });
    
    $('body').on('click', '.deleteImport', function (e) {
        e.preventDefault();
        var frm = document.getElementById("form-import");
        var form = new FormData(frm);
        $.ajax({
            url: SITEURL + "/usersImport/deleteImport",
            dataType: 'json',
            type: 'POST',
            data: form,
            processData: false,
            contentType: false,
            beforeSend: function () {
                $(".preload").fadeIn(300);
            },
            success: function (result) {
                $(".preload").fadeOut(300);
                toastr[result.status](result.msg);
                if (result.status == "success") {
                      $('#load_db').closeModal();
                    setTimeout(function () {
                        location.reload();
                    }, 200);
                }
            }
        });
    });

});


