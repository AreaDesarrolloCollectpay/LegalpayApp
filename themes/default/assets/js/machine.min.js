$(function () { 
        
    //  form update User    
    $('.form-mlModels').on('change', 'input, select, textarea', function(e){
        e.preventDefault();
        var idForm = $(this).closest("form").attr("id");
        var formElement = document.getElementById(idForm);
        var form = new FormData(formElement);  
        $.ajax({
            url: SITEURL + "/machine/saveMlModels",
            dataType: 'json',
            type: 'POST',
            data: form,
            processData: false,
            contentType: false,
            success: function (result) {
                if (result.status == "success") {
                    $('#'+idForm+'-title').html('<div class="triangulo"><i class="fa fa-chevron-down" aria-hidden="true"></i></div>'+result.model.name);                        
                    if(result.model.urlEmbedded != ''){
                        $('#'+idForm+'-urlEmbedded-iframe').attr('src',result.model.urlEmbedded).removeClass('hide');                        
                    }else{
                        $('#'+idForm+'-urlEmbedded-iframe').addClass('hide');                                                
                    }
                    
                    if(result.model.urlBigML != ''){
                        $('#'+idForm+'-iframeExplain').attr('src',result.model.urlBigML).removeClass('hide');                        
                    }else{
                        $('#'+idForm+'-iframeExplain').addClass('hide');                                                
                    }                    
                }else{                    
                    toastr[result.status](result.msg);
                }
            }
        });       
    });

    $('body').on('submit', '.form-mlModels', function (e) {
        e.preventDefault();
        var _this = $(this);
        var form = new FormData(this);
        $.ajax({
            url: SITEURL + "/machine/saveMlModels",
            dataType: 'json',
            type: 'POST',
            data: form,
            processData: false,
            contentType: false,
            beforeSend: function () {
                $(".preload").fadeIn(300);
            },
            success: function (result) {
                $(".preload").fadeOut(300);
                toastr[result.status](result.msg);
                if (result.status == "success") {
                    $('.clear').val('');
                    $('.modal-close').click();
                    setTimeout(function(){
                        location.reload();
                    },800);
                }
            }
        });
    });
    
    // edit MlModels
    
    $('body').on('click', '.editMlModel', function (e) {
        e.preventDefault();
        var _this = $(this);
        var element = "#"+_this.attr("data-element");
        $.ajax({
            url: SITEURL + "/machine/getMlModels",
            dataType: 'json',
            type: 'POST',
            data: {id : _this.attr("data-id")},
            success: function (result) {
                if (result.status == "success") {
                    $.each(result.model,function(index, value){
                        $(element+index).val(value);
                    });                    
                }else{
                    toastr[result.status](result.msg);                    
                }
            }
        });

    });
    
    // show chart
    
    $('body').on('click', '.getChart', function (e) {
        e.preventDefault();
        var _this = $(this);
        var element = _this.attr("data-chart");
               
        $('#iframe-chart-model').attr('src',element);
        
    });
    
    // btn update cluster 

    $('body').on('click', '.editCluster', function (e) {
        e.preventDefault();
        var _this = $(this);
        var element = "#"+_this.attr("data-element");
        console.log(element);
        $.ajax({
            url: SITEURL + "/machine/getClusterForm",
            dataType: 'json',
            type: 'POST',
            data: {id : _this.attr("data-id")},
            success: function (result) {
                if (result.status == "success") {                         
                    $(element+'id').val(result.model.id);   
                    $(element+'name').val(result.model.name);
                    $(element+'clusterCode').val(result.model.clusterCode);
                    $(element+'tags').val(result.model.tags);
                    $(element+'description').val(result.model.description);
                }else{
                    toastr[result.status](result.msg);             
                }
            }
        });

    });

    //  form create/update support debt

    $('body').on('submit', '.form-clusters', function (e) {
        e.preventDefault();
        var form = new FormData(this);
        $.ajax({
            url: SITEURL + "/machine/saveCluster",
            dataType: 'json',
            type: 'POST',
            data: form,
            processData: false,
            contentType: false,
            beforeSend: function () {
                $(".preload").fadeIn(300);
            },
            success: function (result) {
                $(".preload").fadeOut(300);
                toastr[result.status](result.msg);
                if (result.status == "success") {
                    if (result.newRecord) {
                        $('#cluster-' + result.model.id).append(result.html);
                    } else {
                        $('#cluster-' + result.model.id).replaceWith(result.html);
                    }
                    actionModal();
                    $('.modal-close').click();
                }
            }
        });
    });
});

$(window).on('load', function() {
    setTimeout(function(){
        $('#m-wallets').trigger('click');
        $('#m-machine').addClass('active');
    },250);
});

function actionModal() {
//    $(".tooltipped").tooltip();
    $(".modal_clic").leanModal();
}   