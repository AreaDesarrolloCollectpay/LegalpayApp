$(function () {
       
    $("#fileUpload").addClass("activo");
    $("#load_db").hide();
    var lote = null;
    if (lote != null) {
        $("#usersUpload").html('');
        $("#amount").html('');
        $("#load_db").show();
    }
    
    $('html').on('click', '#btnUpload', function () {
        $(this).addClass('hide');
    });
    
    $('input:checkbox').change(
            function () {
                if ($(this).is(':checked')) {
                    $("#cargarData").prop("disabled", false);
                } else {
                    $("#cargarData").prop("disabled", true);
                }
            });

    //  form update User

    $('body').on('submit', '.form-assignments', function (e) {
        e.preventDefault();
        var form = new FormData(this);
        $.ajax({
            url: SITEURL + "/assignments_one/saveAssignments",
            dataType: 'json',
            type: 'POST',
            data: form,
            processData: false,
            contentType: false,
            beforeSend: function () {
                $(".preload").fadeIn(300);
            },
            success: function (result) {
                console.log(result);
                //console.log("hola");
               
                toastr[result.status](result.msg);
                if (result.status == "success") {
                    $('#data-total').html(result.total);
                    $('#data-count').html(result.count);
                    $('#import-lot').val(result.lot);
                    $('#import-idCustomer').val(result.model.idCustomer);
                    $('#import-id').val(result.model.id);
                    
                    setTimeout(function () {
//                        location.reload();
                        $('#load_db').openModal();
                    }, 200);
                }
            },
            complete: function() {
                $(".preload").fadeOut(300);
            
            }
        });
    });
    
    $('body').on('submit', '.form-import-data', function (e) {
        e.preventDefault();
        var form = new FormData(this);
        $.ajax({
            url: SITEURL + "/assignments/importData",
            dataType: 'json',
            type: 'POST',
            data: form,
            processData: false,
            contentType: false,
            beforeSend: function () {
                $(".preload").fadeIn(300);
            },
            success: function (result) {
                $(".preload").fadeOut(300);
                toastr[result.status](result.msg);
                //console.log(result.msg);
                //console.log("hola");
                //if (result.status == "success") {
                      $('#load_db').closeModal();
                    setTimeout(function () {
                        history.go(-1);
                    }, 200);
               // }
            }
        });
    });
    
    $('body').on('click', '.deleteImport', function (e) {
        e.preventDefault();
        var formElement = document.querySelector(".form-import-data");
        var form = new FormData(formElement);  
        $.ajax({
            url: SITEURL + "/assignments/deleteImport",
            dataType: 'json',
            type: 'POST',
            data: form,
            processData: false,
            contentType: false,
            beforeSend: function () {
                $(".preload").fadeIn(300);
            },
            success: function (result) {
                $(".preload").fadeOut(300);
                toastr[result.status](result.msg);
                if (result.status == "success") {
                      $('#load_db').closeModal();
                    setTimeout(function () {
                        location.reload();
                    }, 200);
                }
            }
        });
    });

});

$(window).on('load', function() {
    setTimeout(function () {
        $('#m-wallets').trigger('click');
        $('#m-assignmests').addClass('active');
    }, 250);    
});
