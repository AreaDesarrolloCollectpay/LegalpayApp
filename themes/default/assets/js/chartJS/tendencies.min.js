$(function () {
    $('#m-tendencies').addClass('active');
    
     // For example:
    var myLineChart;
    var labels = [];
    var dataC = [];
    var config = [];
    getChart(0);
    
    function getChart(state){
        
        var formElement = document.querySelector(".form-filter-indicators");
        var form = new FormData(formElement);  
        
        $.ajax({
            url: SITEURL + "/indicators/getChartTendencies",
            async: false,
            dataType: 'json',
            type: 'POST',
            data: form,
            processData: false,
            contentType: false,
            success: function (result) {
                //if (result.status == "success") {                    
                    labels = result.labels;              
                    dataC = result.datac;              
                //}
            }
        });
//        
        config = {
        type: 'line',
        data: {
            labels: labels,
            datasets: dataC 
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            title: {
                display: true,
                text: 'TENDENCIAS CARTERA'
            },
            hover: {
                mode: 'nearest',
                intersect: true
            },            
            scales: {
                xAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Meses del aÃ±o'
                        }, ticks: {
                            autoSkip: false,
                            maxRotation: 90,
                            minRotation: 90,
                            fontSize: 10
                        }, gridLines: {
                            offsetGridLines: true
                        }
                    }],
                yAxes: [{
                        display: true,
                        ticks: {
                            fontSize: 10,
                            callback: function(label, index, labels) {
                                return "$" + Number(label).toFixed(0).replace(/./g, function (c, i, a) {
                                    return i > 0 && c !== "." && (a.length - i) % 3 === 0 ? "," + c : c;
                                });
                            }
                        },
                        scaleLabel: {
                            display: true,
                            labelString: 'Capital',
                        }
                    }]
            },
            legend: {
                display: true,
                position : 'top',
                fullWidth: true,
                labels: {
                    fontSize: 10,
                    boxWidth : 10,
                }
            },
            tooltips: {
                callbacks: {
                    label: function (tooltipItem, data) {
                        return "$" + Number(tooltipItem.yLabel).toFixed(0).replace(/./g, function (c, i, a) {
                            return i > 0 && c !== "." && (a.length - i) % 3 === 0 ? "," + c : c;
                        });
                    }
                }
            }
        }
    };
    
//    console.log(config.data.labels);
//    console.log(config.data.datasets);
        
    var ctx = document.getElementById('canvas-2').getContext('2d');
    ctx.canvas.height = 300;
    if(state == 1){
        myLineChart.destroy();
    }
    myLineChart = new Chart(ctx, config);        
        
    }
    
    $('body').on('change', '.form-indicators', function (e) {
        e.preventDefault();
        getChart(1);
    });    
      
});


