$(function () {
    
    setTimeout(function(){
        $('#m-wallets').trigger('click');
        $('#m-importations').addClass('active');
    },350);

    $("#fileUpload").addClass("activo");
    $("#load_db").hide();
    var lote = null;
    if (lote != null) {
        $("#usersUpload").html('');
        $("#amount").html('');
        $("#load_db").show();
    }
    
    $('html').on('click', '#btnUpload', function () {
        $(this).addClass('hide');
    });
    
    $('input:checkbox').change(
            function () {
                if ($(this).is(':checked')) {
                    $("#cargarData").prop("disabled", false);
                } else {
                    $("#cargarData").prop("disabled", true);
                }
            });

    //  form update User
    
    $('body').on('change', '.select-data-import', function(e){
        e.preventDefault();
        var _this = $(this);
        var _elm = $('#download-pl');
        if(_this.val() != ''){           
            _elm.removeClass('hide');            
        }else{
            _elm.addClass('hide');                        
        }
    });
    
    $('body').on('click', '#download-pl', function(e){
        e.preventDefault();
        var typeImport = $('#type-import').val();
        var customer = $('#customer-na').val();
        var downloadI = $('#downloadI');
        downloadI.attr('href', '#');
        if(customer != 0 && typeImport != 0){
            $.ajax({
                url: SITEURL + "/usersImport/template",
                type: 'POST',
                dataType: 'json',
                data: {customer:customer,typeImport:typeImport},
                success: function (result) {
                    if (result.status == "error") {
                        toastr[result.status](result.msg);
                    }else{
                       downloadI.attr('href', SITEURL + result.file);
                       setTimeout(function(){
                           document.querySelector('#downloadI').click();
                       },100);
                    }
                }
            });
        }
    });

    $('body').on('submit', '.form-users-import', function (e) {
        e.preventDefault();
        var form = new FormData(this);
        $.ajax({
            url: SITEURL + "/usersImport/saveImportationsData",
            dataType: 'json',
            type: 'POST',
            data: form,
            processData: false,
            contentType: false,
            beforeSend: function () {
                $(".preload").fadeIn(300);
            },
            success: function (result) {
                $(".preload").fadeOut(300);
                toastr[result.status](result.msg);
                if (result.status == "success") {
                    $('#data-total').html(result.model.total);
                    $('#data-count').html(result.model.count);
                    $('#import-idCustomer').val(result.model.idCustomer);
                    $('#import-typeImport').val(result.model.typeImport);
                    $('#import-lot').val(result.model.lot);
                    
                    setTimeout(function () {
//                        location.reload();
                        $('#load_db').openModal();
                    }, 200);
                }
            }
        });
    });
    
    $('body').on('submit', '.form-import-data', function (e) {
        e.preventDefault();
        var form = new FormData(this);
        $.ajax({
            url: SITEURL + "/usersImport/importData",
            dataType: 'json',
            type: 'POST',
            data: form,
            processData: false,
            contentType: false,
            beforeSend: function () {
                $(".preload").fadeIn(300);
            },
            success: function (result) {
                $(".preload").fadeOut(300);
                toastr[result.status](result.msg);
                if (result.status == "success") {
                      $('#load_db').closeModal();
                    setTimeout(function () {
                        location.reload();
                    }, 200);
                }
            }
        });
    });
    
    $('body').on('click', '.deleteImport', function (e) {
        e.preventDefault();
        var frm = document.getElementById("form-import");
        var form = new FormData(frm);
        $.ajax({
            url: SITEURL + "/usersImport/deleteImport",
            dataType: 'json',
            type: 'POST',
            data: form,
            processData: false,
            contentType: false,
            beforeSend: function () {
                $(".preload").fadeIn(300);
            },
            success: function (result) {
                $(".preload").fadeOut(300);
                toastr[result.status](result.msg);
                if (result.status == "success") {
                      $('#load_db').closeModal();
                    setTimeout(function () {
                        location.reload();
                    }, 200);
                }
            }
        });
    });

});


