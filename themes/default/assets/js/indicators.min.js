$(function () {
        
    Highcharts.setOptions({
        global: {
            useUTC: false
        },
        lang: {
            thousandsSep: ','
        },
        colors: Highcharts.map(Highcharts.getOptions().colors, function (color) {
            return {
                radialGradient: {
                    cx: 0.5,
                    cy: 0.3,
                    r: 0.7
                },
                stops: [
                    [0, color],
                    [1, Highcharts.Color(color).brighten(-0.3).get('rgb')] // darken
                ]
            };
        })
     });
     
    var seriesOptions = [];
    var title = '';
    var baseColor = '';

    /**
     * Create the chart when all data is loaded
     * @returns {undefined}
     */
    function createChart() {

        var formElement = document.querySelector(".form-filter-indicators");
        var form = new FormData(formElement);

        $.ajax({
            url: SITEURL + "/indicators/getChartIndicators",
            async: false,
            dataType: 'json',
            type: 'POST',
            data: form,
            processData: false,
            contentType: false,
            success: function (result) {
                //if (result.status == "success") {                    
                seriesOptions = result.data;
                title = result.title;
                baseColor = result.color;
                //}
            }
        });
        
        var colorChart = (function () {
            var colors = [],
                    base = baseColor,                
                    i;

            for (i = 0; i <= 10; i += 1) {
                // Start out with a darkened base color (negative brighten), and end
                // up with a much brighter color
                colors.push(Highcharts.Color(base).brighten((i - 5) / 7).get());
            }
            return colors;
        }());

        Highcharts.chart('canvas', {
            chart: {
                plotBackgroundColor: null,
                plotBorderWidth: null,
                plotShadow: false,
                type: 'pie',
//                options3d: {
//                    enabled: true,
//                    alpha: 45,
//                    beta: 0
//                }
            },        
            legend: {
                align: 'left',
                verticalAlign: 'top',
                layout: 'vertical',
                itemDistance: 100,
                x: 0,
                y: 130,
                itemStyle: {
                    "fontWeight": 'normal',
                }
            },
            title: {
                text: title,            
                align: 'left',
                verticalAlign: 'top',
                x: 25,
                y: 15,
                style: {
                    "fontSize": "14px",
                    "fontWeight": 'bold'
                },                                
            },
            tooltip: {
                useHTML: true,
                pointFormat: '<b>$ {point.y:,.0f}</b><br>'+
                             '%{point.percentage:.1f}<br>'+
                             '<span><i class="feather feather-user"></i> {point.cant}</span>'
            },
            plotOptions: {
                pie: {
                    allowPointSelect: true,
                    cursor: 'pointer',
                    depth: 35,
                    point: {
                        events: {
                            click: function () {
                                console.log(this);
                                location.href = this.url;
                            }
                        }
                    }
                }
            },
            series: [{
                    animation: {
                        duration: 0
                    },
                    name: 'Brands',
                    colorByPoint: true,
                    data: seriesOptions
                }],
            exporting: {
                enabled: false
            }
        });  

        setTimeout(function(){
            $('.highcharts-credits').fadeOut('slow');
        },500);
    }

    createChart();
    
    $('body').on('change', '.form-indicators', function (e) {
        e.preventDefault();
        createChart();
    });  
      
});
$(window).on('load', function() {
    setTimeout(function(){
        $('#m-wallets').trigger('click');
        $('#m-indicators').addClass('active');
    },250);
});


