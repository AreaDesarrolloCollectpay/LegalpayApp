$(function () {
    var path = window.location.pathname;
    var pos = path.indexOf('users');
    if(pos >= 0){
        setTimeout(function(){
            $('#m-users').trigger('click');
            $('#m-users').addClass('active');
        },650);
    }else{
        $('#m-customers').addClass('active');
    }
    // btn create customers 

        $('body').on('click', '.createContacts', function (e) {
            e.preventDefault();
            var _this = $(this);
            $(".form-contacts")[0].reset();
            $("#form-contacts-id").val('');
        });

    //  form update Contracts

    $('body').on('submit', '.form-contacts', function (e) {
        e.preventDefault();
        var form = new FormData(this);
        $.ajax({
            url: SITEURL + "/customers/updateContacts",
            dataType: 'json',
            type: 'POST',
            data: form,
            processData: false,
            contentType: false,
            beforeSend: function () {
                $(".preload").fadeIn(300);
            },
            success: function (result) {
                $(".preload").fadeOut(300);
                toastr[result.status](result.msg);
                if (result.status == "success") {
                    $('.clear').val('');
                    $('.modal-close').click();
                    setTimeout(function(){
                        window.location.reload();
                    },800);
                }
            }
        });
    });
    
            
    // update Customers
    
    $('body').on('click', '.editContacts', function (e) {
        e.preventDefault();
        var _this = $(this);
        var element = "#"+_this.attr("data-element");
        console.log(element);
        $.ajax({
            url: SITEURL + "/customers/getContacts",
            dataType: 'json',
            type: 'POST',
            data: {id : _this.attr("data-id")},
            success: function (result) {
                if (result.status == "success") {     
                    if(result.location.idCity != ''){
                        setTimeout(function () {
                            $(element+'idCountry').val(result.location.idCountry).trigger('change');
                            setTimeout(function () {
                               $(element+'idDepartment').val(result.location.idDepartment).trigger('change');
                                setTimeout(function () {
                                   $(element+'idCity').val(result.location.idCity).trigger('change');
                               }, 500);
                           }, 500);
                        }, 500);
                    }
                    $(element+'id').val(result.model.id);   
                    $(element+'name').val(result.model.name);
                    $(element+'mobile').val(result.model.mobile);
                    $(element+'phone').val(result.model.phone);
                    $(element+'email').val(result.model.email);
                    $(element+'position').val(result.model.position);
                }else{
                    toastr[result.status](result.msg);             
                }
            }
        });

    });
    
});


