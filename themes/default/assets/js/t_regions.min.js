$(function () {
   
    var seriesOptions = [];

    Highcharts.setOptions({
        global: {
            useUTC: false
        },
        lang: {
            thousandsSep: ',',
            months: [
                'Enero', 'Febrero', 'Marzo', 'Abril',
                'Mayo', 'Junio', 'Julio', 'Agosto',
                'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
            ],
            shortMonths: [
                "Ene" , "Feb" , "Mar" , "Abr" , "May" , "Jun" , "Jul" , "Ago" , "Sep" , "Oct" , "Nov" , "Dic"                
            ],
            weekdays: [
                'Domingo', 'Lunes', 'Martes', 'Miercoles',
                'Jueves', 'Viernes', 'Sabado'
            ],
            rangeSelectorFrom: 'Desde',
            rangeSelectorTo: 'Hasta'
        },
    });


    /**
     * Create the chart when all data is loaded
     * @returns {undefined}
     */
    function createChart() {

        var formElement = document.querySelector(".form-filter-indicators");
        var form = new FormData(formElement);

        $.ajax({
            url: SITEURL + "/indicators/getChartTendencies",
            async: false,
            dataType: 'json',
            type: 'POST',
            data: form,
            processData: false,
            contentType: false,
            success: function (result) {
                //if (result.status == "success") {                    
                seriesOptions = result.data;
                //}
            }
        });

        Highcharts.stockChart('canvas-2', {
            title: {
                text: 'DISTRIBUCIÒN GEOGRÁFICA',
                style: {
                    "fontSize": "12px",
                    "fontWeight": 'normal'
                },   
            },
            legend: {
                //enabled: true,
                itemStyle: {
                    "fontWeight": 'normal',
                    "fontSize": "10px",
                }

            },
            rangeSelector: {
                selected: 1,
                verticalAlign: 'bottom',
                x: 0,
                y: 0,
                allButtonsEnabled: true,
                buttons: [{
                    type: 'week',
                    count: 1,
                    text: '1 S'
                },{
                    type: 'month',
                    count: 1,
                    text: '1 M'
                }, {
                    type: 'month',
                    count: 3,
                    text: '3 M'
                }, {
                    type: 'month',
                    count: 6,
                    text: '6 M'
                },{
                    type: 'all',
                    text: 'Todo'
                }],
                buttonTheme: {
                    width: 25
                },                
            },
            plotOptions: {
                series: {                
                    marker: {
                        enabled: true,
                        radious: 8,
                        symbol: 'circle'
                    },
                },
            },
            tooltip: {
        formatter: function () {
            var s = '<b>' + Highcharts.dateFormat('%A, %b %e, %Y', this.x) + '</b>';

            $.each(this.points, function () {
                s += '<br/>1 USD = ' + this.y + ' EUR';
            });

            return s;
        }
    },
            series: seriesOptions
        });

        setTimeout(function(){
            $('.highcharts-credits').fadeOut('slow');
        },500);
    }

    createChart();
    
    $('body').on('change', '.form-indicators', function (e) {
        e.preventDefault();
        createChart();
    });  
      
});


