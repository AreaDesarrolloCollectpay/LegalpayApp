$(function () {
    
    $('.select-coordinator').addClass('hide');
        
    //$(".calendar").flatpickr();
    flatpickr('.calendar');
    flatpickr('.calendar_range',
        {
            mode: "range",
            locale: {
                rangeSeparator: ' / '
            }
        }
    );
    // CLICK TO CALL 
    
    $('body').on('click','.click_to_call',function(e){
        e.preventDefault();
        var _this = $(this);
        $("#txtPhoneNumber").val(_this.attr("data-indicative")+_this.attr("data-number"));         
    });
    
    $('body').on('click','.listen-call',function(e){
        e.preventDefault();
        console.log('...');
        var _this = $(this);
        var audio = $('#callPhone');        
        var file = _this.attr('data-file');
        var fileCall = $('#file-call-phone');
        audio[0].pause();
        
        if(audio.attr('idCall') != '' && audio.attr('idCall') != _this.attr('id')){
           $('#'+audio.attr('idCall')).children('i').removeClass('fa-pause').addClass('fa-play');        
        }
        
        if(file != '' && _this.children('i').hasClass("fa-play")){
            audio.attr('idCall',_this.attr('id'));
            fileCall.attr('src',file);            
            audio[0].load();//suspends and restores all audio element
            audio[0].oncanplaythrough = audio[0].play();            
             _this.children('i').removeClass('fa-play').addClass('fa-pause');
             audio[0].addEventListener('pause', function() { _this.children('i').removeClass('fa-pause').addClass('fa-play');});
        }else{
            if(_this.children('i').hasClass("fa-pause")){
                fileCall.attr('src','');            
                _this.children('i').removeClass('fa-pause').addClass('fa-play');                
            }else{                
                toastr['error']('Archivo no encontrado');
            }
        }
    });
//    $('body').on('click','.click_to_call',function(e){
//        e.preventDefault();
//        var _this = $(this);
//        $.ajax({
//            url: SITEURL + "/general/clickToCall" ,
//            dataType: 'json',
//            type: 'POST',
//            data: {idDebtor : _this.attr("data-idDebtor"), idIndicative : $('#debtor-idCity').val(), number : _this.parent().siblings('.call_number').val()},           
//            success: function (result) {
//                if (result.status == "error") {
//                    toastr[result.status](result.msg);
//                }else{
//                    $('#'+divContent).html(result.html);                            
//                }
//            }
//        });
//    });
    
    
       
    // FILTER ADVANCE 
    
        var contentFilter =  $('.content_filter_advance');

        if(contentFilter.size() > 0){
            setTimeout(function(){
                //$('.btn-filter-advance').trigger('click');
                contentFilter.hide().addClass('hideContent');
            },0);
        }

        $('body').on('click','.btn-filter-advance',function(e){
            e.preventDefault();
            var _this = $(this);
            if(contentFilter.hasClass('hideContent')){
                contentFilter.removeClass('hideContent').fadeIn('slow');
                _this.addClass('active');
            }else{
                contentFilter.fadeOut(100).addClass('hideContent');
                _this.removeClass('active');
            }
        });
        
        $('body').on('click','.btn-filter-advance-tab',function(e){
            e.preventDefault();
            var _this = $(this);
            if(_this.parent().parent().parent().siblings('.content_filter_advance').hasClass('hideContent')){
                _this.parent().parent().parent().siblings('.content_filter_advance').removeClass('hideContent').fadeIn('slow');
                _this.addClass('active');
            }else{
                _this.parent().parent().parent().siblings('.content_filter_advance').fadeOut(100).addClass('hideContent');
                _this.removeClass('active');
            }
        });
        
        $('body').on('click','.paginationTab',function(e){
            e.preventDefault();
            var _this = $(this);
            var _id = 'form-filter-'+_this.parent().attr('id');
            var formElement = document.getElementById(_id);
            var form = new FormData(formElement); 
            form.append("page", _this.attr('page'));
            var urlPage = $('#'+_id).closest("form").attr("data-url");
            var divContent = $('#'+_id).closest("form").attr("data-content");

            $.ajax({
                    url: SITEURL + "/" + urlPage,
                    dataType: 'json',
                    type: 'POST',
                    data: form,
                    processData: false,
                    contentType: false,
                    success: function (result) {
                        if (result.status == "error") {
                            toastr[result.status](result.msg);
                        }else{
                            $('#'+divContent).html(result.html);                            
                        }
                    }
                });
            return false;
            
        });  
        
        $('body').on('click','.pagination_ajax',function(e){
            e.preventDefault();
            var _this = $(this);
            var _id = '#'+_this.parent().attr('id')+'-filter-page';
            console.log(_id);
            $(_id).val(_this.attr('page')).change();
            return false;
            
        });  
        
        $('body').on('submit', '.form-filter-tab', function (e){
            e.preventDefault();
            var _this = $(this);
            var form = new FormData(this);
            var urlPage = _this.closest("form").attr("data-url");
            var divContent = _this.closest("form").attr("data-content");
            
            $.ajax({
                    url: SITEURL + "/" + urlPage,
                    dataType: 'json',
                    type: 'POST',
                    data: form,
                    processData: false,
                    contentType: false,
                    success: function (result) {
                        if (result.status == "error") {
                            toastr[result.status](result.msg);
                        }else{
                            $('#'+divContent).html(result.html);  
                            
                            console.log('html');
                        }
                    }
                });
            return false;
        });
        
        $('body').on('submit', '.form-filter', function (e){
            e.preventDefault();
            var urlExplorar = $(this).closest("form").attr("data-url");
            var form = new FormData(this);
            var i = 0;
            form.forEach((value,key) => {

                    if (value != '') {
                        urlExplorar += (i == 0)? '?' + key + '=' + value : '&' + key + '=' + value;
                        i++;
                    }
            });

            window.location = SITEURL + '/' + urlExplorar;

            return false;        
        });

        // BTN FILTER

        $('body').on('click', '.btn-filter-export', function (e){
            e.preventDefault();
            var formElement = document.querySelector(".form-filter");
            var form = new FormData(formElement); 
            var urlExport = $('.form-filter').closest("form").attr("data-export");

            $.ajax({
                    url: SITEURL + "/" + urlExport,
                    dataType: 'json',
                    type: 'POST',
                    data: form,
                    processData: false,
                    contentType: false,
                    success: function (result) {
                        if (result.status == "error") {
                            toastr[result.status](result.msg);
                        }else{
                            window.location.href = SITEURL + result.file;
                        }
                    }
                });
            return false;

        });

        // BTN VIEW LIST

        $('body').on('click', '.btn-filter-type-view', function (e) {
            e.preventDefault();
            var _this = $(this);
            var formElement = document.querySelector(".form-filter");
            var form = new FormData(formElement);
            var urlExplorar = _this.attr("data-url");
            var i = 0;
            form.forEach((value, key) => {

                if (value != '') {
                    urlExplorar += (i == 0) ? '?' + key + '=' + value : '&' + key + '=' + value;
                    i++;
                }
            });

            window.location = SITEURL + '/' + urlExplorar;

            return false;
        });
    
    // CALENDAR // 
    
        
    if($('.calendar_from').size() > 0){
        
        var from_$input = $('.calendar_from').pickadate(configCalendar),
                from_picker = from_$input.pickadate('picker');

        var to_$input = $('.calendar_to').pickadate(configCalendar),
                to_picker = to_$input.pickadate('picker');


    // Check if there’s a “from” or “to” date to start with.
        if (from_picker.get('value')) {
            to_picker.set('min', from_picker.get('select'));
        }
        if (to_picker.get('value')) {
            from_picker.set('max', to_picker.get('select'));
        }

    // When something is selected, update the “from” and “to” limits.
        from_picker.on('set', function (event) {
            if (event.select) {
                to_picker.set('min', from_picker.get('select'));
            } else if ('clear' in event) {
                to_picker.set('min', false);
            }
        });
        to_picker.on('set', function (event) {
            if (event.select) {
                from_picker.set('max', to_picker.get('select'));
            } else if ('clear' in event) {
                from_picker.set('max', false);
            }
        });
        
    }
    
    if($('.calendar_from_m').size() > 0){
        
        var from_$input_m = $('.calendar_from_m').pickadate(configCalendar),
                from_picker_m = from_$input_m.pickadate('picker');

        var to_$input_m = $('.calendar_to_m').pickadate(configCalendar),
                to_picker_m = to_$input_m.pickadate('picker');


    // Check if there’s a “from” or “to” date to start with.
        if (from_picker_m.get('value')) {
            to_picker_m.set('min', from_picker_m.get('select'));
        }
        if (to_picker_m.get('value')) {
            from_picker_m.set('max', to_picker_m.get('select'));
        }

    // When something is selected, update the “from” and “to” limits.
        from_picker_m.on('set', function (event) {
            if (event.select) {
                to_picker_m.set('min', from_picker_m.get('select'));
            } else if ('clear' in event) {
                to_picker_m.set('min', false);
            }
        });
        to_picker_m.on('set', function (event) {
            if (event.select) {
                from_picker_m.set('max', to_picker_m.get('select'));
            } else if ('clear' in event) {
                from_picker_m.set('max', false);
            }
        });
        
    }

    $('body').on('change', '.select-typeReference', function (e) {
        e.preventDefault();
        var _this = $(this);
        var element = "#"+_this.closest("form").attr("data-id")+"idRelationshipType";
        $.ajax({
            url: SITEURL + '/general/getRelationship/',
            dataType: 'json',
            type: 'POST',
            data: {id: _this.val()},
            success: function (result) {
                if (result.status == 'success') {
                    $(element).html('');
                    $(element).html(result.html);
                } else {
                    toastr[result.status](result.msg);
                }
            }
        });
    });
    
    $('body').on('change', '.select-country', function (e) {
        e.preventDefault();
        var _this = $(this);
        var element = "#"+_this.closest("form").attr("data-id")+"idDepartment";
        $.ajax({
            url: SITEURL + '/general/getDepartments',
            dataType: 'json',
            type: 'POST',
            data: {id: _this.val()},
            success: function (result) {
                if (result.status == 'success') {
                    $(element).html('');
                    $(element).html(result.html);
                } else {
                    toastr[result.status](result.msg);
                }
            }
        });
    });
    
    $('body').on('change', '.select-country-all', function (e) {
        e.preventDefault();
        var _this = $(this);
        var element = "#"+_this.closest("form").attr("data-id")+"idCity";
        console.log(element);
        $.ajax({
            url: SITEURL + '/general/getCitiesAll',
            dataType: 'json',
            type: 'POST',
            data: {id: _this.val()},
            success: function (result) {
                if (result.status == 'success') {
                    $(element).html('');
                    $(element).html(result.html);
                } else {
                    toastr[result.status](result.msg);
                }
            }
        });
    });
    
    $('body').on('change', '.select-department', function (e) {
        e.preventDefault();
        var _this = $(this);
        var element = "#"+_this.closest("form").attr("data-id")+"idCity";
        $.ajax({
            url: SITEURL + '/general/getCities',
            dataType: 'json',
            type: 'POST',
            data: {id: _this.val()},
            success: function (result) {
                if (result.status == 'success') {
                    $(element).html('');
                    $(element).html(result.html);
                } else {
                    toastr[result.status](result.msg);
                }
            }
        });
    });
    
    $('body').on('change', '.select-userProfile', function (e) {
        e.preventDefault();
        var _this = $(this);
        var element = "#"+_this.closest("form").attr("data-id")+"idCoordinator";
        $.ajax({
            url: SITEURL + '/general/getCoordinators',
            dataType: 'json',
            type: 'POST',
            data: {id: _this.val()},
            success: function (result) {
                if (result.status == 'success') {
                    $(element).html('');
                    $(element).html(result.html);
                    if(result.selected){
                        $(element).val(result.idCoordinator).trigger('change');   
                    }else{
                        $('.select-coordinator').removeClass('hide');                        
                    }
                } else {
                    $('.select-coordinator').addClass('hide');
                }
            }
        });
    });
        
    $('body').on('change', '.select-coordinatorsAd', function (e) {
        var _this = $(this);
        var element = "#"+_this.closest("form").attr("data-id")+"idAdviser";
        $.ajax({
            url: SITEURL + '/general/GetAdvisers',
            dataType: 'json',
            type: 'POST',
            data: {id: _this.val()},
            success: function (result) {
                if (result.status == 'success') {
                    $(element).html('');
                    $(element).html(result.html);
                } else {
                    toastr[result.status](result.msg);
                }
            }
        });
    });
    
    $('body').on('change', '.select-tasksAction', function (e) {
        e.preventDefault();
        var _this = $(this);
        var element = "#"+_this.closest("form").attr("data-id")+"idTasksEffect";
        $.ajax({
            url: SITEURL + '/general/getTasksEffects/',
            dataType: 'json',
            type: 'POST',
            data: {id: _this.val()},
            success: function (result) {
                if (result.status == 'success') {
                    $(element).html('');
                    $(element).html(result.html);
                } else {
                    console.log(result.msg);
                }
            }
        });
    });
    
    $('body').on('change', '.changeLang', function (e) {
        e.preventDefault();
        var _this = $(this);
        $.ajax({
            url: SITEURL + '/site/changeIdioma',
            dataType: 'json',
            type: 'POST',
            data: {lang: _this.val()},
            success: function (result) {
                if (result.status == 'success') {
                    location.reload();
                } else {
                    console.log(result.msg);
                }
            }
        });
    }); 
    
    $('body').on('click', '.btnHelpLinks', function (e) {
        e.preventDefault();
        var _this = $(this);
        $.ajax({
            url: SITEURL + "/general/getHelpLinks",
            dataType: 'json',
            type: 'POST',
            data: {type : _this.attr("data-id")},
            success: function (result) {
                if (result.status == "success") {
                   $("#helpLinks").html(result.html);
                }else{
                    toastr[result.status](result.msg);
                    
                }
            }
        });

    });
    
    $('body').on('click', '.search-modal', function (e) {
        e.preventDefault();
        $(".form-seach-modal")[0].reset();
        $("#resultSearch-modal").fadeOut(300);
    });
        
    /* Form search-modal */
    
     $('body').on('submit', '.form-seach-modal', function (e) {
        e.preventDefault();
        var form = new FormData(this);
                    
        $.ajax({
                url: SITEURL + "/general/searchDebtor",
                dataType: 'json',
                type: 'POST',
                data: form,
                processData: false,
                contentType: false,
                beforeSend: function () {
                    $(".preload").fadeIn(300);
                    $("#resultSearch-modal").fadeOut(300);
                },
                success: function (result) {
                    $(".preload").fadeOut(300);
                    if (result.status == "success") {
                        $("#content-search").html(result.html);
                        $("#resultSearch-modal").fadeIn('slow');                         
                    }else{
                        toastr[result.status](result.msg);
                    }
                }
            });
        return false;
    });
    
    /* CHANGE STATE LEGAL */
    
    $('body').on('change', '.select-debtorStateLegal', function (e) {
            e.preventDefault();
            var _this = $(this);
            var element = _this.attr('data-substate')+'SubState';
            $.ajax({
                url: SITEURL + '/wallet/getSubstate',
                dataType: 'json',
                type: 'POST',
                data: {idState : _this.val()},
                beforeSend: function () {
                    $(".preload").fadeIn(300);
                },
                success: function (result) {
                    $(".preload").fadeOut(300);
                    if(result.status == 'success'){
                        //$('#btn-form-state-legal').removeClass('hide');
                        $(element).empty();
                        $(element).html(result.html);
                        setTimeout(function(){
                            smartSelect();
                            
                        },500);
                    }else{
                        toastr[result.status](result.msg);                        
                    }
                }
            });
        
        });
        
    /* CHANGE OFFICE LEGAL */
        
        
    $('body').on('change', '.select-idOfficeLegal', function (e) {
            e.preventDefault();
            var _this = $(this);
            var element = "#"+_this.closest("form").attr("data-id")+"idCategoryLegal";
            $.ajax({
                url: SITEURL + '/general/getCategoryLegal',
                dataType: 'json',
                type: 'POST',
                data: {id : _this.val()},
                beforeSend: function () {
                    $(".preload").fadeIn(300);
                },
                success: function (result) {
                    $(".preload").fadeOut(300);
                    if(result.status == 'success'){
                        $(element).empty();
                        $(element).html(result.html);
                    }else{
                        toastr[result.status](result.msg);                        
                    }
                }
            });
        
        });
       
    /* View support */
        
        $('body').on('click','.view-support', function(e){
        e.preventDefault();        
        var _this = $(this); 
        $.ajax({
            url: SITEURL + "/general/viewSupport",
            dataType: 'json',
            type: 'POST',
            data: {file : _this.attr('href')},            
            success: function (result) {                
                if (result.status == "success") {
                    $("#content-view_support").html(result.html);
                    setTimeout(function(){
                        $("#view_support").openModal();  
                        $("#content-view_support .materialboxed").materialbox();
                    },500);                    
                }
            }
        });
        
        
    });
    
    /* Get notifications */
        
        $('body').on('click', '.getNotifications', function (e) {
            e.preventDefault();
            var _this = $(this);
            $.ajax({
                url: SITEURL + "/general/getNotifications",
                dataType: 'json',
                type: 'POST',
                data: {},
                success: function (result) {
                    if (result.status == "success") {
                        $("#content-notifications").html(result.html);
                    }
                }
            });


        });
        
        
        /*$("ul li").on("click", "a",function(e){
            e.preventDefault();
            alert("hello");
            var _this = $(this);
            $.ajax({
                url: SITEURL + "/general/getNotifications",
                dataType: 'json',
                type: 'POST',
                data: {},
                success: function (result) {
                    if (result.status == "success") {
                        $("#content-notifications").html(result.html);
                    }
                }
            });


        });*/
    
    
    
    /* AMORTIZATION */
    
        /* Get info amortization */
    
        $('body').on('click', '.btn-amortization', function (e) {
            e.preventDefault();
            console.log('fadeOut');
            $("#results-content-amortization,#btn_generate_amortization,#item-amortization").fadeOut(5);
//            $.ajax({
//                url: SITEURL + "/general/getDebtorAmortization",
//                dataType: 'json',
//                type: 'POST',
//                data: {idDebtor : _this.attr('data-idDebtor')},
//                success: function (result) {
//                    if (result.status == "success") {
//                        $("#content-form-amortization").html(result.html);
//                        $("#debtors_amortization").openModal();
//                    }
//                }
//            });
        });
        
        $('body').on('click', '#btn_generate_amortization', function (e) {
            e.preventDefault();
            $("#results-content-amortization,#btn_generate_amortization").fadeOut(50);
            $("#clone-content-amortization").replaceWith($("#results-amortization").clone());
            $("#item-amortization").fadeIn('slow'); 
        });
        
        /* Calculate Amortization */
        
        $('body').on('submit', '.form-debtor-amortization', function (e) {
            e.preventDefault();
            var form = new FormData(this);

            $.ajax({
                    url: SITEURL + "/general/calculateAmortizacion",
                    dataType: 'json',
                    type: 'POST',
                    data: form,
                    processData: false,
                    contentType: false,
                    beforeSend: function () {
                        $(".preload").fadeIn(300);
                        $("#results-content-amortization").fadeOut(300);
                    },
                    success: function (result) {
                        $(".preload").fadeOut(300);
                        if (result.status == "success") {
                            $("#btn_generate_amortization").fadeIn(50);
                            $("#results-amortization").html(result.html);
                            $("#results-content-amortization").fadeIn('slow');                         
                        }else{
                            toastr[result.status](result.msg);
                        }
                    }
                });
            return false;
        });
        
        
        // Quote Initial
        
        $('body').on('change', '#form-debtor-amortization-capital-txt', function () {
            var _this = $(this);
            $('#form-debtor-amortization-capital').val(_this.val());
            console.log($('#form-debtor-amortization-capital').val());
            _this.val(numeral(_this.val()).format('0,0'));
            calculateAmortization();            
        });
        
         $('body').on('change', '.quote_initial', function (e) {            
            calculateAmortization();         
         });
         
         $('body').on('change', '.agreement', function (e) {
             var agreement, quote_initial = '';
             var type_solution = $('#form-debtor-amortization-type_solution').val();             
             quote_initial = (agreement != '' && type_solution != 1)?  Math.round(((agreement * 20) / 100)) : 0; 
             $('#form-debtor-amortization-quote_initial').val(quote_initial);
         });
         
        
        // Terms AND agreemet USERS             
        $('body').on('submit', '.form-check-terms', function (e) {
            e.preventDefault();
            var form = new FormData(this);

            $.ajax({
                    url: SITEURL + "/general/checkTerms",
                    dataType: 'json',
                    type: 'POST',
                    data: form,
                    processData: false,
                    contentType: false,
                    beforeSend: function () {
                        $(".preload").fadeIn(300);
                    },
                    success: function (result) {
                        $(".preload").fadeOut(300);
                            toastr[result.status](result.msg);
                        if (result.status == "success") {
                            setTimeout(function(){
                                $(".form-check-terms")[0].reset();
                                $('#check-terms').closeModal();
                             },800);
                        }
                    }
                });
            return false;
        });
        
        
        $('body').on('change', '.filter-mlModels', function (e) {
            e.preventDefault();
            var _this = $(this);
            var _closest = $(this).attr("data-closest");
            var element = "#"+_this.closest(_closest).attr("data-id")+"idCluster";
            console.log(element);
            $.ajax({
                url: SITEURL + '/general/getClusters',
                dataType: 'json',
                type: 'POST',
                data: {id: _this.val()},
                success: function (result) {
                    if (result.status == 'success') {
                        $(element).html('');
                        $(element).html(result.html);
                    } else {
                        toastr[result.status](result.msg);
                    }
                }
            });
        });
//        
//        var iframe2 = document.getElementById('mlModels-2--urlEmbedded-iframe');
//        iframe2.load = function(){
//            console.log('hide iframe');
//            $("#Iframe").contents().find(".mypage-header2").hide();
//            $('.link_to_bigml').hide();
//            $('.link_to_bigml').css('opacity',0);
//            $('#mlModels-2--urlEmbedded-iframe').contents().find('.link_to_bigml_embedded').hide();
//        };
        
        $('body').on('click', '.acordeon_cluster', function (e) {
            e.preventDefault();
            var _this = $(this);
            var element = _this.attr("data-id");
            var iframe = $('#'+element+'urlEmbedded').val();
            var iframeExplain = $('#'+element+'urlBigML').val();
            var contentIframe = $('#'+element+'iframeEmbedded');
            var contentExplain = $('#'+element+'iframeExplain');
//            && contentIframe.is(':empty')
            if(iframe != '' ){
                contentIframe.html('<iframe id="'+element+'-urlEmbedded-iframe" allow="fullscreen" src="'+iframe+'" style="width:100%; height:375px;" frameborder="0"></iframe>');                
                contentExplain.html('<iframe id="'+element+'-urlEmbedded-explain" allow="fullscreen" src="'+iframeExplain+'" style="width:100%; height:375px;" frameborder="0"></iframe>');                
                               
            }else{
                console.log('none');
            }

        });
        
        $('body').on('change','.filter-table',function(){
            var _this = $(this);
            var formUrl = _this.closest('tr').attr("data-url");
            var formData = new FormData();
            console.log('filters2');
            $('.filter-table', _this.closest('tr')).each(function () {
                var _field = $(this);                                        
                if(_field.val() != ''){                    
                    formData.append(_field.attr('name'), _field.val());                    
                }                
            }); 
            formData.append('ajax', true);    
            if(_this.attr('name') != 'page'){
                formData.append('page', 0);                    
            }
            $.ajax({
                    url: SITEURL + '/'+formUrl,
                    dataType: 'json',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (result) { 
						console.log(result);
                        if (result.status == "success") {
                            $('#tbody-'+_this.closest('tr').attr("data-id")).html(result.table);
                            $('#pagination-'+_this.closest('tr').attr("data-id")).html(result.pagination);
                        }
                    }
                });
            console.log('test');
            console.log(SITEURL + '/'+formUrl);     
			console.log(JSON.stringify(formData)); 
            return false;
    });
    
    $('body').on('click','.getChartModel',function(e){
        e.preventDefault();
        var _this = $(this);
        var _type = _this.attr('data-type');
        
        $.ajax({
            url: SITEURL + '/wallet/getChartModel',
            dataType: 'json',
            type: 'POST',
            data: {id : 0, type : _type},
            success: function (result) {
                if (result.status == "success") {
                    if(_type == 'modal'){
                        $('#contentModelMLChart-modal').html(result.html);
                        $("#modal_mlchart").openModal();
                    }else{
                        $('#contentModelMl').addClass('hide');
                        $('#contentModelMLChart').empty().html(result.html).removeClass('hide');                        
                    }
                }
            }
        });
    });
          
setInterval(pushTaks,60000);
});

function calculateAmortization(){
    var capital = $('#form-debtor-amortization-capital').val();
    var tnmv = $('#form-debtor-amortization-tnmv').val();
    var type_solution = $('#form-debtor-amortization-type_solution').val();
    var dis = $('#form-debtor-amortization-discount').val();
    var discount_percent = 0, rate = 0, discount = 0, agreement = 0, quote_initial = 0;   
    var time = '';
        
    if(type_solution == 3){
        rate = tnmv;
        discount_percent = (type_solution != '')? 8 : 0;                
        time = '<option value="3">3</option><option value="4">4</option>';
    }else if(type_solution == 1 || type_solution == 2){
        discount_percent = (type_solution != '')? 25 : 0;                
        if(type_solution == 1){
            time = '<option value="1">1</option>';                    
        }else{                    
            time = '<option value="1">1</option><option value="2">2</option><option value="3">3</option>';
        }
    }
    
    discount = numeral((capital != '' && dis == 1)? Math.round(((capital * discount_percent) / 100)) : 0);            
    agreement =  numeral(capital - discount.value());

    quote_initial = numeral((agreement.value() != '' && type_solution != 1)?  Math.round(((agreement.value()) * 20) / 100) : 0);             

    $('#form-debtor-amortization-time').html(time);

    $('#form-debtor-amortization-agreement').val(agreement.value());
    $('#form-debtor-amortization-agreement-txt').val(agreement.format('0,0'));

    $('#form-debtor-amortization-quote_initial').val(quote_initial.value());
    $('#form-debtor-amortization-quote_initial-txt').val(quote_initial.format('0,0'));

    $('#form-debtor-amortization-discount_value').val(discount_percent);
    $('#form-debtor-amortization-interest').val(rate);
}
function ShowTooltipped(show){
    if(!show){        
        $(".tooltipped").tooltip();
    }else{
        $('.tooltipped').tooltip('remove');
    }
}
function hideMl(){
    $(".hide-ml").remove();
}
function hideAdviser(){
    $(".hide-adviser").remove();
}
function hideCoordinator(){
    $(".hide-coordinator").remove();
}
function hideCustomer(){
    $(".hide-customer").remove();
}
function hideWallet(){
    $(".hide-wallet").remove();
}
function hideCall(){
    $(".hide-call").remove();
}
function hideSms(){
    $(".hide-sms").remove();
}
function hideEmail(){
    $(".hide-email").remove();
}

function pushTaks(){
    $.ajax({
        url: SITEURL + '/tasks/pushTaks',
        dataType: 'json',
        method: 'POST',
        data:{},
        success: function(result) {
            if(result.status == "success"){
                if(Push.Permission.has()){                    
                    console.log('perm');
                    showNotification(result.data);
                }else{
                    Push.Permission.request();
                    console.log('permnnnn');
                }
            }
        }
    });
}

function showNotification(data){
    console.log('show');
        Push.create(data.title, {
            body: data.msg,
            icon: data.img,
            //timeout: 12000,
            onClick: function () {
                window.focus();
                this.close();
                window.open(data.url);
            }
        });
//    Push.create("Hola, Dayron!", {
//        body: "Tienes una nueva tarea para completar en tu panel.",
//        icon: "https://www.collectpay.co/demo/themes/default/assets/img/icons/icon_alert_push.png",
//        // timeout: 6000,
//        onClick: function () {
//            window.focus();
//            this.close();
//            window.open("https://www.collectpay.co/demo/tasks");
//        }
//    });
}

function zoom() {
    document.body.style.zoom = "90%"; 
}



